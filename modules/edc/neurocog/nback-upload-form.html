<div id=D__ID>
	<div class="container mt-95 mb-3">
		<div class="row">
			<!-- form container start -->
			<div class="col-12 col-lg-12 col-md-12 col-sm-12 mx-auto formbox">
				<div class="row">
					<div class="col-12">
						<!-- form start -->
						<form id="F__ID">
							<h3>N BACK Checking Calculations</h3>
							<div class="row px-4">
								<div class='col'>
									<label><span class=""></span>
									</label>
								</div>
							</div>
							<hr>
							<!-- participant part for all tsak forms -------------------->
							<div id="participant_div__ID">
								<div class="row px-4">
									<div class="col-sm-12 col-lg-9 ">
										<span class=label__ID>Participant</span><br>
										<input type=text name="Participant" class=form-control id=Participant__ID
											data-id="Participant" />
									</div>
									<div class="col-sm-12 col-lg-3">
										<span class=label__ID>Participant ID</span><br>
										<input type=text name="Participant_uid" class=form-control readonly />
									</div>
								</div>
								<hr>
							</div>
							<!-- form group -->
							<button type="submit" id="submit__ID" class="btn btn-primary btn-lg">Submit</button>
							<hr>
                            <div class="row px-4">
                                <div class='col'>
                                    <span>File</span>
                                    <div class="form-control">
                                        <u style='cursor:pointer' id=link_File_Name__ID></u>
                                        <br>
                                        <input type="file" name=File_Name style="margin-top:6px" /> &nbsp&nbsp&nbsp
                                        <button type="button" id=x_File_Name__ID>Remove</button>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-3">
                                    <label class=''><span class=''>NBACK</span>
                                        <input class="form-control" type="text" name="NBACK" />
                                    </label>
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>Start_Time</span>
                                        <input class="form-control" type="text" name="Start_Time" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NGTA</span>
                                        <input class="form-control" type="text" name="NGTA" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NGRT</span>
                                        <input class="form-control" type="text" name="NGRT" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>GMRT</span>
                                        <input class="form-control" type="text" name="GMRT" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NTCR</span>
                                        <input class="form-control" type="text" name="NTCR" />
                                    </label>
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NTIC</span>
                                        <input class="form-control" type="text" name="NTIC" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NMIS</span>
                                        <input class="form-control" type="text" name="NMIS" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NMRT</span>
                                        <input class="form-control" type="text" name="NMRT" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>MRTCM</span>
                                        <input class="form-control" type="text" name="MRTCM" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>MRTCN</span>
                                        <input class="form-control" type="text" name="MRTCN" />
                                    </label>
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>SDCR</span>
                                        <input class="form-control" type="text" name="SDCR" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>SDCM</span>
                                        <input class="form-control" type="text" name="SDCM" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>SDCN</span>
                                        <input class="form-control" type="text" name="SDCN" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>MdRTCR</span>
                                        <input class="form-control" type="text" name="MdRTCR" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>MdRTCM</span>
                                        <input class="form-control" type="text" name="MdRTCM" />
                                    </label>
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-3">
                                    <label class=''><span class=''>MnRTCR</span>
                                        <input class="form-control" type="text" name="MnRTCR" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-3">
                                    <label class=''><span class=''>MxRTCR</span>
                                        <input class="form-control" type="text" name="MxRTCR" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-3">
                                    <label class=''><span class=''>MF10CR</span>
                                        <input class="form-control" type="text" name="MF10CR" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-3">
                                    <label class=''><span class=''>MS10CR</span>
                                        <input class="form-control" type="text" name="MS10CR" />
                                    </label>
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-3">
                                    <label class=''><span class=''>SDF10CR</span>
                                        <input class="form-control" type="text" name="SDF10CR" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-3">
                                    <label class=''><span class=''>SDS10CR</span>
                                        <input class="form-control" type="text" name="SDS10CR" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-3">
                                </div>
                                <div class="col-sm-12 col-lg-3">
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NTCM</span>
                                        <input class="form-control" type="text" name="NTCM" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NTCN</span>
                                        <input class="form-control" type="text" name="NTCN" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NTFM</span>
                                        <input class="form-control" type="text" name="NTFM" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NTFN</span>
                                        <input class="form-control" type="text" name="NTFN" />
                                    </label>
                                </div>
                                <div class="col-sm-12 col-lg-2">
                                    <label class=''><span class=''>NTWR</span>
                                        <input class="form-control" type="text" name="NTWR" />
                                    </label>
                                </div>
                            </div>
                            <hr>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-12">
                                    <label style='width:100%'><span class=''>NNO</span>
                                        <input class="form-control" type="text" name="NNO" />
                                    </label>
                                </div>
                            </div>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-12">
                                    <label style='width:100%'><span class=''>NRT</span>
                                        <input class="form-control" type="text" name="NRT" />
                                    </label>
                                </div>
                            </div>
                            <div class='row px-4'>
                                <div class="col-sm-12 col-lg-12">
                                    <label style='width:100%'><span class=''>NAC</span>
                                        <input class="form-control" type="text" name="NAC" />
                                    </label>
                                </div>
                            </div>
                            <hr>
                         </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    VmInclude:__COMPONENT__/m/model.01.html
	<script>
		function F__ID() {
			//-------------------------------------
			VmInclude: __COMPONENT__/f/form.01.js
			VmInclude: __CURRENT_PATH__/../../library/shared-form.js
            //-------------------------------------
            var nback=1;
			var numtrials = 53; //This is the normal number of trials.
            //-------------------------------------
            var load2 = m.load;
            m.load = function () {
                load2();
                if (m.input.readonly != undefined) $('#submit__ID').hide();
                //render_file_field_v2(m.input.record,'__ID',$('#File_Name__ID'));
                m.set_file_link("File_Name");
            }
            //-------------------------------------
            $('#F__ID input[name=File_Name]').on('change', function (evt) {
                nback=$('#F__ID input[name=NBACK]').val();
                if (this.files.length == 1) {
                    file_process(this.files[0])
                }
            })
            var data={};
            //-------------------------------------
            var file_process = function (file) {
                var reader = new FileReader();
                reader.onload = (function (e) {
                    var contents = e.target.result;
                    var lines = contents.replace(/"/g, '').replace(/\r/, '\n').replace(/\n\n/, '\n').split('\n');
                    data.NNO=lines[0];
                    data.NRT=lines[1];
                    data.NAC=lines[2];
                    calc(data)
                });
                reader.readAsText(file);
            }
            //-------------------------------------
            var calc=function(data){
            /*
                var no="PRE,1,2,3,4,5,6,7,8,9,10,11,12,13"
                var nno=no.split(",")
                var rt="0,779,1011,1093,2998,3001,1812,1040,1110,954,621,771,961,1262"
                var nrt=rt.split(",")
                var ac="-,CN,CN,CN,CN,CN,CM,CM,CN,CM,CM,CM,FN,CM"
                var nac=ac.split(",")
            */	
            var nno=data.NNO.split(",");
            var nrt=data.NRT.split(",");
            var nac=data.NAC.split(",");
            var ngta=0;
            var nrgt=0;
            var ntcr=0;
            var ntcrm=0;
            var ntcrn=0;
            var ntic=0;
            var ntmr=0;
            var nmis=0;
            var ntwr=0;
            var nmrt=0;
            var nmrtm=0;
            var nmrtn=0;
            var nmrta=[];
            var nmrtma=[];
            var nmrtna=[];
            var mrtcm=0;
            var ntfrm=0;
            var ntfrn=0;
            for (var i=0;i<nno.length;i++){
                if(nno[i]!='1' && nno[i]!='2' && nno[i]!='3' && nno[i]!='PRE'){
                    if( nac[i]=='CM')   {ntcr++;ntcrm++;nmrt+=parseInt(nrt[i]);nmrtm+=parseInt(nrt[i]);nmrta.push(nrt[i]);nmrtma.push(nrt[i]);}
                    if( nac[i]=='CN')   {ntcr++;ntcrn++;nmrt+=parseInt(nrt[i]);nmrtn+=parseInt(nrt[i]);nmrta.push(nrt[i]);nmrtna.push(nrt[i]);}
                    if( nac[i]=='O')    nmis++;
                    if( nac[i]=='FM')   {ntic++;ntfrm++;}
                    if( nac[i]=='FN')   {ntic++;ntfrn++;}
                    if( nac[i]=='W')    ntwr++;
                    nrgt=nrgt+parseInt(nrt[i]);
                }
            }
            if( ntcr+ntic > 0){
                ngta=(100*ntcr/(ntcr+ntic)).toFixed(1)
                data.NGTA=ngta;
                data.GMRT=(nrgt/(nno.length-3-nback)).toFixed(0);
            }
            else  data.NGTA='0';
            data.NBACK=nback;
            data.NTCR=ntcr;
            data.NMIS=nmis;
            data.NTIC=ntic;
            data.NGRT=nrgt;
            if(ntcr>0) data.NMRT=(nmrt/ntcr).toFixed(0);
            else data.NMRT='0';
            if(ntcrm>0) data.MRTCM=(nmrtm/ntcrm).toFixed(0);
            else data.MRTCM='0';
            if(ntcrn>0) data.MRTCN=(nmrtn/ntcrn).toFixed(0);
            else data.MRTCN='0';
            if(nmrta.length>1){
                var sdcr=standardDeviation(nmrta);
                data.SDCR=sdcr.toFixed(0);
            }
            else data.SDCR=0;
            if(nmrtma.length>1){
                var sdcm=standardDeviation(nmrtma);
                data.SDCM=sdcm.toFixed(0);
            }
            else data.SDCM=0;
            if(nmrtna.length>1){
                var sdcn=standardDeviation(nmrtna);
                data.SDCN=sdcn.toFixed(0);
            }
            else data.SDCN=0;

            if(nmrta.length>1){
                var mdrtcr=median(nmrta);
                data.MdRTCR=mdrtcr.toFixed(0);
            }
            else data.MdRTCR=0;
            if(nmrtma.length>1){
                var mdrtcm=median(nmrtma);
                data.MdRTCM=mdrtcm.toFixed(0);
            }
            else data.MdRTCM=0;
            if(nmrtna.length>1){
                var mdrtcn=median(nmrtna);
                data.MdRTCN=mdrtcn.toFixed(0);
            }
            else data.MdRTCN=0;
            if(nmrta.length>0){
                var mnrtcr=getmin(nmrta);
                data.MnRTCR=mnrtcr;
                var mxrtcr=getmax(nmrta);
                data.MxRTCR=mxrtcr;
                var mf10cra=top10pc(nmrta);
                var mf10cr=average(mf10cra);
                data.MF10CR=mf10cr;
                var ms10cra=bottom10pc(nmrta);
                var ms10cr=average(ms10cra);
                data.MS10CR=ms10cr;
            }
            else {
                data.MnRTCR='0';
                data.MxRTCR='0';
                data.MF10CR='0';
                data.MS10CR='0';
            }
            if(mf10cra!=undefined && mf10cra.length > 1){
                var sdf10cr=standardDeviation(mf10cra);
                data.SDF10CR=sdf10cr.toFixed(0);
            }
            else data.SDF10CR='0';
            if(ms10cra!=undefined && ms10cra.length > 1){
                var sds10cr=standardDeviation(ms10cra);
                data.SDS10CR=sds10cr.toFixed(0);
            }
            else data.SDS10CR='0';
            data.NTCM=ntcrm;
            data.NTCN=ntcrn;
            data.NTFM=ntfrm;
            data.NTFN=ntfrn;
            data.NTWR=ntwr;

            $('input[name="NBACK"]').val(data.NBACK);
            $('input[name="Start_Time"]').val(data.Start_Time);
            $('input[name="NGTA"]').val(data.NGTA);
            $('input[name="NGRT"]').val(data.NGRT);
            $('input[name="GMRT"]').val(data.GMRT);
            $('input[name="NTCR"]').val(data.NTCR);
            $('input[name="NTIC"]').val(data.NTIC);
            $('input[name="NMIS"]').val(data.NMIS);
            $('input[name="NMRT"]').val(data.NMRT);
            $('input[name="MRTCM"]').val(data.MRTCM);
            $('input[name="MRTCN"]').val(data.MRTCN);
            $('input[name="SDCR"]').val(data.SDCR);
            $('input[name="SDCM"]').val(data.SDCM);
            $('input[name="SDCN"]').val(data.SDCN);
            $('input[name="MdRTCR"]').val(data.MdRTCR);
            $('input[name="MdRTCM"]').val(data.MdRTCM);
            $('input[name="MnRTCR"]').val(data.MnRTCR);
            $('input[name="MxRTCR"]').val(data.MxRTCR);
            $('input[name="MF10CR"]').val(data.MF10CR);
            $('input[name="MS10CR"]').val(data.MS10CR);
            $('input[name="SDF10CR"]').val(data.SDF10CR);
            $('input[name="SDS10CR"]').val(data.SDS10CR);
            $('input[name="NTCM"]').val(data.NTCM);
            $('input[name="NTCN"]').val(data.NTCN);
            $('input[name="NTFM"]').val(data.NTFM);
            $('input[name="NTFN"]').val(data.NTFN);
            $('input[name="NTWR"]').val(data.NTWR);
            $('input[name="NNO"]').val(data.NNO);
            $('input[name="NRT"]').val(data.NRT);
            $('input[name="NAC"]').val(data.NAC);
        }
        //-------------------------------------
        //-------------------------------------
        function standardDeviation(values){
            var avg = average(values); 
            var squareDiffs = values.map(function(value){
                var diff = value - avg;
                var sqrDiff = diff * diff;
                return sqrDiff;
            });
            var avgSquareDiff = average(squareDiffs)*values.length/(values.length-1);
            var stdDev = Math.sqrt(avgSquareDiff);
            return stdDev;
        }
        //-------------------------------------
        function median(values){
            if(values.length ===0) return 0;
            values.sort(function(a,b){
                return a-b;
            });
            var half = Math.floor(values.length / 2);
            if (values.length % 2){
                return values[half]/1.0;
            }
            return ((values[half - 1])/1.0 + (values[half])/1.0) / 2.0;
        }            
        //-------------------------------------
        function average(data){
            var sum = data.reduce(function(sum, value){
                return sum + Math.abs(value);
            }, 0);
            var avg = sum / data.length;
            return avg;
        }
        //-------------------------------------
        function getmin(values){
            values.sort(function(a, b){return b - a})
            return values[values.length-1];
        }
        //-------------------------------------
        function getmax(values){
            values.sort(function(a, b){return b - a})
            return values[0];
        }
        //-------------------------------------
        function top10pc(values){
            if(values.length ===0) return 0;
            values.sort(function(a,b){
                return a-b;
            });
            var tenpc = Math.round(values.length / 10);
            return values.slice(0,tenpc);
        }            
        //-------------------------------------
        function bottom10pc(values){
            if(values.length ===0) return 0;
            values.sort(function(a,b){
                return a-b;
            });
            var tenpc = Math.round(values.length / 10);
            return values.slice(values.length-tenpc-1,values.length);
        }            
        //------------------------------------
	}
    </script>
	<style>
        #D__ID .mt-95 {
            max-width: 800px;
        }

        VmInclude:__CURRENT_PATH__/wappsystem-form.css
	</style>
</div>